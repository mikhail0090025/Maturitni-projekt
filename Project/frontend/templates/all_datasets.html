{% extends "base.html" %}

{% block title %}All Datasets{% endblock %}

{% block head %}
{% endblock %}

{% block content %}
<h1>All Datasets</h1>
<!--
[{'id': 2, 'name': 'string', 'description': '', 'storage_id': 'string', 'owner_id': 1, 'created_at': '2025-11-19 18:13:49.710317+00:00'}]
-->
<a href="/new_dataset_page"><button type="button" class="btn btn-primary">New Dataset</button></a>
{% if datasets %}
    <ul>
    {% for dataset in datasets %}
        <li>
            <strong>{{ dataset.name }}</strong><br>
            Type: {{ dataset.dataset_type_description }}<br>
            <!-- Storage ID: {{ dataset.storage_id }}<br> -->
            Owner : {{ name }}, {{ surname }} (<i>{{ username }}</i>)<br>
            Created At: {{ dataset.created_at }}
            <button class="btn btn-danger" name="delete-button" storage-id="{{ dataset.storage_id }}">Delete</button>
            <button class="btn btn-primary" name="download-button" storage-id="{{ dataset.storage_id }}">Download</button>
        </li>
    {% endfor %}
    </ul>
{% else %}
    <p>No datasets available.</p>
{% endif %}
<script>
document.addEventListener("DOMContentLoaded", () => {
    // Удаление
    document.querySelectorAll('button[name="delete-button"]').forEach(btn => {
        btn.addEventListener("click", async () => {
            const storageId = btn.getAttribute("storage-id");
            if (!confirm("Are you sure you want to delete this dataset?")) return;
            try {
                fetch(`/datasets/by_storage/${storageId}`, { method: "DELETE" }).then(response => {
                    if (response.ok) {
                        alert("Dataset deleted successfully");
                        location.reload();
                    } else {
                        response.json().then(data => {
                            alert("Error deleting dataset: " + data.detail);
                        });
                    }
                });
            } catch (e) {
                alert("Network error");
            }
        });
    });

    // Скачивание
    document.querySelectorAll('button[name="download-button"]').forEach(btn => {
        btn.addEventListener("click", () => {
            const storageId = btn.getAttribute("storage-id");
            window.location.href = `/datasets/download/${storageId}`;
        });
    });
});
</script>
{% endblock %}