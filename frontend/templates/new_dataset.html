{% extends "base.html" %}

{% block title %}New dataset{% endblock %}

{% block head %}
{% endblock %}

{% block content %}
<h1>New Dataset</h1>
<div>
    <label for="dataset-name">Name:</label>
    <input type="text" id="dataset-name" name="dataset-name" required><br><br>
    <label for="description">Description (Optional):</label><br>
    <textarea id="description" name="description" rows="4" cols="50"></textarea><br><br>
    <label for="file">Select dataset (ZIP file):</label>
    <input type="file" id="file" name="file" accept=".zip" required><br><br>
    <button class="btn btn-primary" id="upload_dataset_button">Upload Dataset</button>
</div>
<script>
document.getElementById("upload_dataset_button").addEventListener("click", async () => {
    const name = document.getElementById("dataset-name").value;
    const description = document.getElementById("description").value;
    const fileInput = document.getElementById("file");

    if (!name.trim()) {
        alert("Write dataset name!");
        return;
    }
    if (fileInput.files.length === 0) {
        alert("Choose ZIP-file!");
        return;
    }

    const formData = new FormData();
    formData.append("file", fileInput.files[0]);
    formData.append("name", name);
    formData.append("description", description);

    console.log("Uploading dataset:", name, description, fileInput.files[0]);

    const response = await fetch("/upload/zip", {
        method: "POST",
        body: formData
    });

    const result = await response.json();
    console.log(result);

    if (!response.ok) {
        alert("Ошибка: " + result.detail);
        return;
    }

    alert("Dataset uploaded successfully!");
});
</script>
{% endblock %}